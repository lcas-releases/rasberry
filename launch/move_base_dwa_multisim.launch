<?xml version="1.0"?>
<launch>
    <!--arg name="map"/-->
    <arg name="robot_name" default=""/>
    <arg name="tf_prefix" default="$(arg robot_name)"/>

    <arg name="robot_pose_x" default="0" />
    <arg name="robot_pose_y" default="0" />
    <arg name="robot_pose_z" default="0" />
    <arg name="robot_pose_R" default="0" />
    <arg name="robot_pose_P" default="0" />
    <arg name="robot_pose_Y" default="0" />

    <!--arg name="map" default="$(find rasberry_navigation)/maps/riseholme_sim.yaml"/-->

    <!-- lanch map server -->
    <!--node name="map_server" pkg="map_server" type="map_server" args="$(arg map)"/-->

    <group ns="$(arg robot_name)">

      <remap from="map" to="/map"/>

      <!-- launch robot_pose_publisher -->
      <node pkg="robot_pose_publisher" type="robot_pose_publisher" name="robot_pose_publisher" respawn="true">
        <param name="~map_frame" value="/map"/>
        <param name="~base_frame" value="$(arg tf_prefix)/base_link"/>
      </node>

      <!-- launch AMCL -->
      <include file="$(find rasberry_move_base)/launch/amcl.launch"/>
      <rosparam param="amcl/odom_frame_id" subst_value="True">$(arg robot_name)/odom</rosparam>
      <rosparam param="amcl/base_frame_id" subst_value="True">$(arg robot_name)/base_link</rosparam>
      <rosparam param="amcl/initial_pose_x" subst_value="True">$(arg robot_pose_x)</rosparam>
      <rosparam param="amcl/initial_pose_y" subst_value="True">$(arg robot_pose_y)</rosparam>
      <rosparam param="amcl/initial_pose_a" subst_value="True">$(arg robot_pose_Y)</rosparam>

      <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen" clear_params="true">
          <remap from="cmd_vel" to="nav_vel"/>
          <remap from="odom" to="odometry/base_raw"/>

          <!--Parameters-->

          <!--Local planner-->
          <!--param name="controller_frequency" value="10.0"/>
          <param name="controller_patience" value="15.0"/>
          <param name="planner_frequency" value="0.5"/-->
          <rosparam file="$(find rasberry_move_base)/config/dwa/dwa_planner_ros.yaml" command="load"/>
          <rosparam file="$(find rasberry_move_base)/config/dwa/dwa_move_base_params.yaml" command="load"/>
          <!--rosparam param="DWAPlannerROS/odom_topic" subst_value="True">$(arg robot_name)/odometry/base_raw</rosparam-->

          <rosparam file="$(find rasberry_move_base)/config/costmap_common_params.yaml" command="load" ns="global_costmap"/>
          <rosparam param="global_costmap/global_obstacle_layer/laser_scan_sensor/sensor_frame" subst_value="True">$(arg tf_prefix)/hokuyo</rosparam>
          <rosparam param="global_costmap/global_obstacle_layer/laser_scan_sensor/topic" subst_value="True">scan</rosparam>
          <rosparam param="global_costmap/robot_base_frame" subst_value="True">$(arg tf_prefix)/base_link</rosparam>

          <rosparam file="$(find rasberry_move_base)/config/costmap_common_params.yaml" command="load" ns="local_costmap"/>
          <rosparam param="local_costmap/obstacle_layer/laser_scan_sensor/sensor_frame" subst_value="True">$(arg tf_prefix)/hokuyo</rosparam>
          <rosparam param="local_costmap/obstacle_layer/laser_scan_sensor/topic" subst_value="True">scan</rosparam>
          <rosparam param="local_costmap/robot_base_frame" subst_value="True">$(arg tf_prefix)/base_link</rosparam>

          <rosparam file="$(find rasberry_move_base)/config/local_costmap_params.yaml" command="load"/>
          <rosparam file="$(find rasberry_move_base)/config/global_costmap_params.yaml" command="load"/>
	  <rosparam file="$(find rasberry_move_base)/config/nav_fn_ros.yaml" command="load" />

      </node>
    </group>
    
</launch>
